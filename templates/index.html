{% extends "base.html" %}

{% block content %}
<div id="holder" class="carousel slide holder" data-bs-ride="carousel" data-bs-interval="false">
  <div class="carousel-inner">
    {% for i, item in elements%}
      {% if i == 0 %}
        {% if item.get_type() == "image" %}
          <div class="carousel-item active"  data-bs-interval="false">
            <img src="{{ item.get_src() }}" class="d-block w-100">
          </div>
        {% else %}
          {% if item.get_type() == "video" %}
            <div class="carousel-item active"  data-bs-interval="false">
              <video id="vid{{ item.get_number() }}" src="{{ item.get_src() }}"></video>
            </div>
          {% else %}
            {% if item.get_type() == "text" %}
              <div class="carousel-item active"  data-bs-interval="false">
                <div class="">
                  <iframe src="{{ item.get_src() }}"></iframe>
                </div>
              </div>
            {% else %}
            {% endif %}
          {% endif %}
        {% endif %}
      {% else %}
        {% if item.get_type() == "image" %}
          <div class="carousel-item"  data-bs-interval="false">
            <img src="{{ item.get_src() }}" class="d-block w-100">
          </div>
        {% else %}
          {% if item.get_type() == "video" %}
            <div class="carousel-item"  data-bs-interval="false">
              <video id="vid{{ item.get_number() }}" src="{{ item.get_src() }}"></video>
            </div>
          {% else %}
            {% if item.get_type() == "text" %}
              <div class="carousel-item"  data-bs-interval="false">
                <div class="">
                  <iframe src="{{ item.get_src() }}"></iframe>
                </div>
              </div>
            {% else %}
            {% endif %}
          {% endif %}
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#holder" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#holder" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>



<script type="text/javascript">

  function get_current_image() {
          var holder = document.querySelector('#holder');
          var carousel = bootstrap.Carousel.getInstance(holder);
          $.ajax({
              url: '/api/current_element',
              type: 'get',
              response: 'json',
              success: function(data)
              {
                if (data["element"] && data["element"] != "stop")
                {
                  var holder = document.querySelector('#holder');
                  var carousel = bootstrap.Carousel.getInstance(holder);
                  carousel.to(data["element"]);
                  if (data["type"] == "video")
                  {
                    var vid = document.querySelector('#vid' + data["element"]);
                    vid.play();
                  }

                }
                if (data["element"] == "stop")
                {
                  clearInterval(timer);
                }

              }
          });

  };



get_current_image();

let timer = setInterval(get_current_image, 1000);

</script>
{% endblock %}
